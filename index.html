<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èœå–®èªéŸ³è¨ˆç®—æ©Ÿ</title>
    <style>
        body {
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #007bff;
            font-size: 24px;
        }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .menu-item {
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            border: 1px solid #dee2e6;
        }
        .menu-item strong {
            display: block;
            font-size: 16px;
            margin-bottom: 5px;
            color: #28a745;
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #startButton {
            background-color: #ffc107;
            color: #333;
        }
        #startButton:hover {
            background-color: #e0a800;
        }
        #output, #result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            min-height: 30px;
            border: 1px dashed #ccc;
            text-align: left;
        }
        #result {
            font-size: 22px;
            font-weight: bold;
            color: #dc3545;
            background-color: #ffe0e6;
        }
        #status {
            margin-top: 10px;
            color: #007bff;
            font-style: italic;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>èªéŸ³èœå–®è¨ˆç®—æ©Ÿ</h1>

    <div id="status">é»æ“ŠæŒ‰éˆ•ï¼Œé–‹å§‹èªªå‡ºæ‚¨çš„è¨‚å–® (ä¾‹: ç‡’é¤…ä¸‰å€‹, ç‰›è‚‰é¤¡é¤…äº”å€‹, è›‹é¤…ä¸€å€‹)</div>
    <button id="startButton">ğŸ™ï¸ é–‹å§‹èªéŸ³è¼¸å…¥</button>
    
    <div id="output">è¾¨è­˜çµæœ:</div>
    <div id="result">ç¸½é‡‘é¡: $0</div>

    <h2>èœå–®å“é …åƒè€ƒ</h2>
    <div class="menu-grid">
        <div class="menu-item"><strong>è±¬è‚‰è›‹é¤…</strong><br>$70</div>
        <div class="menu-item"><strong>ç‰›è‚‰è›‹é¤…</strong><br>$70</div>
        <div class="menu-item"><strong>è”¬èœè›‹é¤…</strong><br>$45</div>
        <div class="menu-item"><strong>ç‰ç±³è›‹é¤…</strong><br>$45</div>
		<div class="menu-item"><strong>è›‹é¤…</strong><br>$35</div>
        <div class="menu-item"><strong>è±¬è‚‰é¤¡é¤…</strong><br>$45</div>
        <div class="menu-item"><strong>ç‰›è‚‰é¤¡é¤…</strong><br>$45</div>
		<div class="menu-item"><strong>éŸ­èœé¤…</strong><br>$26</div>
        <div class="menu-item"><strong>è”¥é¤…</strong><br>$26</div>
        <div class="menu-item"><strong>ç´…è±†é¤…</strong><br>$24</div>
        <div class="menu-item"><strong>èŠ‹é ­é¤…</strong><br>$24</div>
		<div class="menu-item"><strong>ç‡’é¤…</strong><br>$24</div>
		<div class="menu-item"><strong>æ²¹æ¢</strong><br>$22</div>
        <div class="menu-item"><strong>ç‡’é¤…æ²¹æ¢</strong><br>$46</div>
        <div class="menu-item"><strong>ç‡’é¤…è‚‰ç‰‡</strong><br>$55</div>
        <div class="menu-item"><strong>ç‡’é¤…è”¥è›‹</strong><br>$42</div>
        <div class="menu-item"><strong>ç‡’é¤…è·åŒ…è›‹</strong><br>$39</div>
        <div class="menu-item"><strong>è”¥è›‹</strong><br>$18</div>
        <div class="menu-item"><strong>è·åŒ…è›‹</strong><br>$15</div>
        <div class="menu-item"><strong>è±†æ¼¿</strong><br>$20</div>
		<div class="menu-item"><strong>ç´…èŒ¶</strong><br>$20</div>
        <div class="menu-item"><strong>å¥¶èŒ¶</strong><br>$20</div>
        <div class="menu-item"><strong>é¹¹è±†æ¼¿</strong><br>$30</div>
    </div>
</div>

<script>
    // æ ¹æ“šæ‚¨æä¾›çš„èœå–®å“é …å’Œåƒ¹æ ¼é‡æ–°å®šç¾©
    const menu = {
        'è±¬è‚‰è›‹é¤…': 70,
        'ç‰›è‚‰è›‹é¤…': 70,
        'è”¬èœè›‹é¤…': 45,
        'ç‰ç±³è›‹é¤…': 45,
        'è›‹é¤…': 35,
        'è±¬è‚‰é¤¡é¤…': 45,
        'ç‰›è‚‰é¤¡é¤…': 45,
        'éŸ­èœé¤…': 26, // ç”¨æˆ¶æ–°å¢
        'è”¥é¤…': 26,   // ç”¨æˆ¶æ–°å¢
        'ç´…è±†é¤…': 24,
        'èŠ‹é ­é¤…': 24,
        'ç‡’é¤…': 24,
        'æ²¹æ¢': 22, // åƒ¹æ ¼èª¿æ•´ç‚º 22
        'ç‡’é¤…æ²¹æ¢': 46,
        'ç‡’é¤…è‚‰ç‰‡': 55, 
        'ç‡’é¤…è”¥è›‹': 42, 
        'ç‡’é¤…è·åŒ…è›‹': 39,
        'è”¥è›‹': 18,
        'è·åŒ…è›‹': 15,
        'è±†æ¼¿': 20,
        'ç´…èŒ¶': 20,
        'å¥¶èŒ¶': 20,
        'é¹¹è±†æ¼¿': 30
    };

    const startButton = document.getElementById('startButton');
    const outputDiv = document.getElementById('output');
    const resultDiv = document.getElementById('result');
    const statusDiv = document.getElementById('status');
    
    // ç²å–å“é …åç¨±ä¸¦æŒ‰ç…§é•·åº¦å¾é•·åˆ°çŸ­æ’åº (é•·å“é …å„ªå…ˆ)
    const itemNames = Object.keys(menu).sort((a, b) => b.length - a.length);
    // å»ºç«‹ç”¨æ–¼ Master Regex çš„å“é …åç¨±å­—ä¸²
    const itemPattern = itemNames.join('|');
    
    // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Web Speech API (ç¨‹å¼ç¢¼ä¸è®Š)
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        statusDiv.textContent = 'æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨/è¨­å‚™ä¸æ”¯æ´èªéŸ³è¼¸å…¥åŠŸèƒ½ (Web Speech API)ã€‚è«‹ä½¿ç”¨æœ€æ–°ç‰ˆ Safariã€‚';
        startButton.disabled = true;
    } else {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const SpeechSynthesis = window.SpeechSynthesis || window.webkitSpeechSynthesis;

        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.lang = 'zh-TW';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        const synth = window.speechSynthesis;

        recognition.onstart = () => {
            statusDiv.textContent = 'æ­£åœ¨è½æ‚¨èªªè©±... è«‹èªªå‡ºè¨‚å–® (ä¾‹: ç‡’é¤…ä¸‰å€‹, ç‰›è‚‰é¤¡é¤…äº”å€‹)';
            startButton.disabled = true;
            startButton.textContent = 'ğŸ”´ éŒ„éŸ³ä¸­...';
        };

        recognition.onend = () => {
            statusDiv.textContent = 'èªéŸ³è¼¸å…¥çµæŸï¼Œæ­£åœ¨è¨ˆç®—ã€‚';
            startButton.disabled = false;
            startButton.textContent = 'ğŸ™ï¸ é–‹å§‹èªéŸ³è¼¸å…¥';
        };

        // èªéŸ³è¾¨è­˜çµæœ (æª¢æŸ¥ä¿ç•™)
        recognition.onresult = (event) => {
            if (event.results.length > 0 && event.results[0].length > 0) {
                const transcript = event.results[0][0].transcript;
                outputDiv.textContent = 'è¾¨è­˜çµæœ: ' + transcript;
                
                if (transcript && transcript.trim() !== '') {
                    calculateAndSpeak(transcript);
                } else {
                    outputDiv.textContent = 'è¾¨è­˜çµæœ: (ç„¡æœ‰æ•ˆèªéŸ³è¼¸å…¥)';
                    resultDiv.innerHTML = `ç¸½é‡‘é¡: $0`;
                }
            } else {
                outputDiv.textContent = 'è¾¨è­˜å¤±æ•—æˆ–æ²’æœ‰åµæ¸¬åˆ°æœ‰æ•ˆèªéŸ³ã€‚';
                resultDiv.innerHTML = `ç¸½é‡‘é¡: $0`;
            }
        };

        recognition.onerror = (event) => {
            statusDiv.textContent = 'èªéŸ³è¾¨è­˜éŒ¯èª¤: ' + event.error + 'ã€‚è«‹å†è©¦ä¸€æ¬¡ã€‚';
            startButton.disabled = false;
            startButton.textContent = 'ğŸ™ï¸ é–‹å§‹èªéŸ³è¼¸å…¥';
        };

        startButton.onclick = () => {
            try {
                recognition.start();
            } catch (e) {
                statusDiv.textContent = 'è«‹å…è¨±ç€è¦½å™¨ä½¿ç”¨éº¥å…‹é¢¨ã€‚éŒ¯èª¤: ' + e.message;
            }
        };

        /**
         * åŸ·è¡Œè¨‚å–®è¨ˆç®—ä¸¦èªéŸ³å”¸å‡ºçµæœ
         * @param {string} orderText - èªéŸ³è¾¨è­˜çš„æ–‡æœ¬
         */
        function calculateAndSpeak(orderText) {
            let total = 0;
            let orderSummary = {};
            let speechOutput = 'æ‚¨çš„è¨‚å–®æ˜¯ï¼š';

            // 1. æ•¸å­—å’Œé‡è©è™•ç† (V5 èª¿æ•´ï¼šç§»é™¤æ‰€æœ‰é‡è©å’Œåˆ†éš”ç¬¦è™Ÿï¼Œè®“æ–‡æœ¬å®Œå…¨é€£çºŒ)
            let processedText = orderText
                // æ›¿æ›ä¸­æ–‡æ•¸å­—
                .replace(/ä¸€/g, '1')
                .replace(/äºŒ|å…©/g, '2')
                .replace(/ä¸‰/g, '3')
                .replace(/å››/g, '4')
                .replace(/äº”/g, '5')
                .replace(/å…­/g, '6')
                .replace(/ä¸ƒ/g, '7')
                .replace(/å…«/g, '8')
                .replace(/ä¹/g, '9')
                .replace(/é›¶/g, '0')
                // ç§»é™¤æ‰€æœ‰é‡è©å’Œåˆ†éš”ç¬¦è™Ÿï¼Œè®“æ–‡æœ¬é€£çºŒ (e.g., éŸ­èœé¤…2è”¥é¤…1)
                .replace(/å€‹|ä»½|æ¯|ã€|ï¼Œ|,|ã€‚/g, ''); 

            // 2. V5 æ ¸å¿ƒé‚è¼¯ï¼šå–®ä¸€ Master Regex æƒæé€£çºŒæ–‡æœ¬
            
            // Regex è§£é‡‹:
            // å°‹æ‰¾ (å¯é¸æ•¸å­—) + (å“é …åç¨±) + (å¯é¸æ•¸å­—)
            // (\\d*)ï¼š0å€‹æˆ–å¤šå€‹æ•¸å­— (å“é …å‰çš„æ•¸é‡)
            // (${itemPattern})ï¼šå¿…é¸çš„å“é …åç¨± (æœ€é•·çš„åç¨±æœƒå„ªå…ˆè¢«åŒ¹é…)
            // (\\d*)ï¼š0å€‹æˆ–å¤šå€‹æ•¸å­— (å“é …å¾Œçš„æ•¸é‡)
            const masterRegex = new RegExp(
                `(\\d*)(${itemPattern})(\\d*)`, 'gi'
            );

            let match;
            
            // 3. éæ­·æ‰€æœ‰åŒ¹é…é … (é€™æ˜¯ V5 èˆ‡ V4 æœ€å¤§çš„ä¸åŒï¼Œå®ƒåœ¨é€£çºŒæ–‡æœ¬ä¸Šæ›´å¯é )
            while ((match = masterRegex.exec(processedText)) !== null) {
                
                const item = match[2];
                let quantity = 0;

                // å„ªå…ˆä½¿ç”¨æ•¸å­—ï¼Œå¦‚æœå‰å¾Œéƒ½æœ‰æ•¸å­—ï¼Œå‰‡å–è¼ƒå¤§çš„æ•¸å­—ï¼ˆå‡è¨­æ˜¯ç‚ºäº†å¼·èª¿æˆ–èªéŸ³é‡è¤‡ï¼‰
                if (match[1] && match[3]) {
                     // å‰å¾Œéƒ½æœ‰æ•¸å­—ï¼Œé€™é€šå¸¸è¡¨ç¤ºèªéŸ³è¾¨è­˜æœ‰èª¤ï¼Œå–å…©è€…ä¸­è¼ƒå¤§çš„ä¸€å€‹ï¼Œç¢ºä¿ä¸æ¼ç®—
                     quantity = Math.max(parseInt(match[1] || 0, 10), parseInt(match[3] || 0, 10));
                }
                else if (match[1]) { // æ•¸å­—åœ¨å“é …å‰ (e.g., 2éŸ­èœé¤…)
                    quantity = parseInt(match[1], 10);
                } else if (match[3]) { // æ•¸å­—åœ¨å“é …å¾Œ (e.g., éŸ­èœé¤…2)
                    quantity = parseInt(match[3], 10);
                } else {
                    // æ²’æœ‰æ‰¾åˆ°æ•¸å­—ï¼Œå‡è¨­ç‚º 1 (e.g., éŸ­èœé¤…)
                    quantity = 1;
                }
                
                // æ’é™¤æ•¸é‡ç‚º 0 çš„æƒ…æ³
                if (menu[item] && quantity > 0) {
                    const itemCost = quantity * menu[item];
                    // æª¢æŸ¥æ˜¯å¦å·²ç¶“è¨ˆç®—éï¼Œé¿å…é‡è¤‡è¨ˆç®— (å› ç‚º Master Regex å¯èƒ½æœƒé‡è¤‡åŒ¹é…é•·çŸ­å“é …)
                    if (!orderSummary[item] || orderSummary[item] < quantity) {
                        
                        // ç¢ºä¿é•·å“é …å„ªå…ˆåŸå‰‡: 
                        // å¦‚æœé€™æ˜¯é•·å“é … (e.g., è±¬è‚‰è›‹é¤…)ï¼Œå‰‡ç§»é™¤å…¶å­å“é …çš„æ•¸é‡ (e.g., è›‹é¤…)
                        if (item.includes('è›‹é¤…') && item.length > 2 && orderSummary['è›‹é¤…']) {
                             delete orderSummary['è›‹é¤…'];
                             total -= (orderSummary['è›‹é¤…'] || 0) * menu['è›‹é¤…'];
                        }
                        
                        orderSummary[item] = quantity;
                        total += itemCost;
                    }
                }
            }
            
            // ç”±æ–¼ V5 çš„ Master Regex æœƒåœ¨ä¸€æ¬¡æƒæä¸­æ‰¾åˆ°æ‰€æœ‰æ±è¥¿ï¼Œ
            // ç‚ºäº†é¿å…çŸ­å“é …ï¼ˆå¦‚ã€Œè›‹é¤…ã€ï¼‰è¢«é‡è¤‡è¨ˆç®—ï¼Œæˆ‘å€‘åœ¨è¨ˆç®—ç¸½å’Œæ™‚é€²è¡Œæœ€çµ‚æ¸…ç†ã€‚
            total = 0;
            let finalOrderSummary = {};
            
            // é‡æ–°è¨ˆç®—ç¸½é‡‘é¡ä¸¦ç§»é™¤é‡è¤‡é …
            for (const item of itemNames) {
                 if (orderSummary[item] && itemNames.some(
                     longerItem => longerItem.length > item.length && 
                     longerItem.includes(item) && 
                     orderSummary[longerItem])) {
                     // å¦‚æœæ‰¾åˆ°ä¸€å€‹æ›´é•·çš„å“é …åŒ…å«äº†é€™å€‹çŸ­å“é …ï¼Œä¸¦ä¸”é‚£å€‹é•·å“é …ä¹Ÿè¢«é»äº†ï¼Œ
                     // å‰‡å¿½ç•¥é€™å€‹çŸ­å“é …çš„è¨ˆæ•¸ã€‚
                     continue;
                 }
                 
                 if (orderSummary[item]) {
                     const quantity = orderSummary[item];
                     const itemCost = quantity * menu[item];
                     total += itemCost;
                     finalOrderSummary[item] = quantity;
                 }
            }


            // 4. æ ¼å¼åŒ–è¼¸å‡ºå’ŒèªéŸ³å…§å®¹
            let summaryText = '<ul>';
            let speechItems = [];
            for (const item in finalOrderSummary) {
                const quantity = finalOrderSummary[item];
                const cost = quantity * menu[item];
                summaryText += `<li>${item} x ${quantity} = $${cost}</li>`;
                speechItems.push(`${item}${quantity}å€‹`);
            }
            summaryText += '</ul>';

            if (total === 0) {
                resultDiv.innerHTML = `ç¸½é‡‘é¡: $0`;
                speechOutput = 'æŠ±æ­‰ï¼Œæˆ‘æ²’æœ‰è½æ¸…æ¥šæ‚¨çš„è¨‚å–®ï¼Œæˆ–æ˜¯èœå–®ä¸Šæ²’æœ‰æ‚¨é»çš„å“é …ã€‚è«‹å†èªªä¸€æ¬¡ã€‚';
            } else {
                resultDiv.innerHTML = `ç¸½é‡‘é¡: $${total}` + summaryText;
                speechOutput += speechItems.join('ï¼Œ') + `ã€‚ç¸½å…±æ˜¯ ${total} å…ƒã€‚`;
            }

            // èªéŸ³è¼¸å‡º
            const utterance = new SpeechSynthesisUtterance(speechOutput);
            utterance.lang = 'zh-TW';
            synth.speak(utterance);
        }
    }
</script>
</body>
</html>
