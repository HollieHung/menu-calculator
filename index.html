<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èœå–®èªéŸ³è¨ˆç®—æ©Ÿ</title>
    <style>
        body {
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #007bff;
            font-size: 24px;
        }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .menu-item {
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            border: 1px solid #dee2e6;
        }
        .menu-item strong {
            display: block;
            font-size: 16px;
            margin-bottom: 5px;
            color: #28a745;
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #startButton {
            background-color: #ffc107;
            color: #333;
        }
        #startButton:hover {
            background-color: #e0a800;
        }
        #output, #result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            min-height: 30px;
            border: 1px dashed #ccc;
            text-align: left;
        }
        #result {
            font-size: 22px;
            font-weight: bold;
            color: #dc3545;
            background-color: #ffe0e6;
        }
        #status {
            margin-top: 10px;
            color: #007bff;
            font-style: italic;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>èªéŸ³èœå–®è¨ˆç®—æ©Ÿ</h1>

    <div id="status">é»æ“ŠæŒ‰éˆ•ï¼Œé–‹å§‹èªªå‡ºæ‚¨çš„è¨‚å–® (ä¾‹: ç‡’é¤…ä¸‰å€‹, ç‰›è‚‰é¤¡é¤…äº”å€‹, è›‹é¤…ä¸€å€‹)</div>
    <button id="startButton">ğŸ™ï¸ é–‹å§‹èªéŸ³è¼¸å…¥</button>
    
    <div id="output">è¾¨è­˜çµæœ:</div>
    <div id="result">ç¸½é‡‘é¡: $0</div>

    <h2>èœå–®å“é …åƒè€ƒ</h2>
    <div class="menu-grid">
        <div class="menu-item"><strong>è±¬è‚‰è›‹é¤…</strong><br>$70</div>
        <div class="menu-item"><strong>ç‰›è‚‰è›‹é¤…</strong><br>$70</div>
        <div class="menu-item"><strong>è”¬èœè›‹é¤…</strong><br>$45</div>
        <div class="menu-item"><strong>ç‰ç±³è›‹é¤…</strong><br>$45</div>
		<div class="menu-item"><strong>è›‹é¤…</strong><br>$35</div>
        <div class="menu-item"><strong>è±¬è‚‰é¤¡é¤…</strong><br>$45</div>
        <div class="menu-item"><strong>ç‰›è‚‰é¤¡é¤…</strong><br>$45</div>
		<div class="menu-item"><strong>éŸ­èœé¤…</strong><br>$26</div>
        <div class="menu-item"><strong>è”¥é¤…</strong><br>$26</div>
        <div class="menu-item"><strong>ç´…è±†é¤…</strong><br>$24</div>
        <div class="menu-item"><strong>èŠ‹é ­é¤…</strong><br>$24</div>
		<div class="menu-item"><strong>ç‡’é¤…</strong><br>$24</div>
		<div class="menu-item"><strong>æ²¹æ¢</strong><br>$22</div>
        <div class="menu-item"><strong>ç‡’é¤…æ²¹æ¢</strong><br>$46</div>
        <div class="menu-item"><strong>ç‡’é¤…è‚‰ç‰‡</strong><br>$55</div>
        <div class="menu-item"><strong>ç‡’é¤…è”¥è›‹</strong><br>$42</div>
        <div class="menu-item"><strong>ç‡’é¤…è·åŒ…è›‹</strong><br>$39</div>
        <div class="menu-item"><strong>è”¥è›‹</strong><br>$18</div>
        <div class="menu-item"><strong>è·åŒ…è›‹</strong><br>$15</div>
        <div class="menu-item"><strong>è±†æ¼¿</strong><br>$20</div>
		<div class="menu-item"><strong>ç´…èŒ¶</strong><br>$20</div>
        <div class="menu-item"><strong>å¥¶èŒ¶</strong><br>$20</div>
        <div class="menu-item"><strong>é¹¹è±†æ¼¿</strong><br>$30</div>
    </div>
</div>

<script>
    // æ ¹æ“šåœ–ç‰‡å®šç¾©èœå–®å“é …å’Œåƒ¹æ ¼ (å“é …åç¨±ç›¡é‡ç²¾ç°¡ä»¥åˆ©èªéŸ³è¾¨è­˜)
    const menu = {
        'è±¬è‚‰è›‹é¤…': 70,
        'ç‰›è‚‰è›‹é¤…': 70,
        'è”¬èœè›‹é¤…': 45,
        'ç‰ç±³è›‹é¤…': 45,
		'è›‹é¤…': 35,
        'è±¬è‚‰é¤¡é¤…': 45,
        'ç‰›è‚‰é¤¡é¤…': 45,
		'éŸ­èœé¤…': 26,
        'è”¥è‚‰é¤…': 26,
        'ç´…è±†é¤…': 24,
        'èŠ‹é ­é¤…': 24,
		'ç‡’é¤…': 24,
		'æ²¹æ¢': 24,
		'ç‡’é¤…æ²¹æ¢': 46,
        'ç‡’é¤…è‚‰ç‰‡': 55, // ç°¡åŒ– "ç‡’é¤…æ²¹æ¢+è›‹"
        'ç‡’é¤…è”¥è›‹': 42, // ç°¡åŒ– "ç‡’é¤…è‚‰é¬†+è›‹"
        'ç‡’é¤…è·åŒ…è›‹': 39,
        'è”¥è›‹': 18,
        'è·åŒ…è›‹': 15,
        'è±†æ¼¿': 20,
		'ç´…èŒ¶': 20,
        'å¥¶èŒ¶': 20,
        'é¹¹è±†æ¼¿': 30
    };

    const startButton = document.getElementById('startButton');
    const outputDiv = document.getElementById('output');
    const resultDiv = document.getElementById('result');
    const statusDiv = document.getElementById('status');
    
    // ç²å–å“é …åç¨±ä¸¦æŒ‰ç…§é•·åº¦å¾é•·åˆ°çŸ­æ’åº (é•·å“é …å„ªå…ˆ)
    const itemNames = Object.keys(menu).sort((a, b) => b.length - a.length);

    // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Web Speech API (ç¨‹å¼ç¢¼ä¸è®Š)
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        statusDiv.textContent = 'æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨/è¨­å‚™ä¸æ”¯æ´èªéŸ³è¼¸å…¥åŠŸèƒ½ (Web Speech API)ã€‚è«‹ä½¿ç”¨æœ€æ–°ç‰ˆ Safariã€‚';
        startButton.disabled = true;
    } else {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const SpeechSynthesis = window.SpeechSynthesis || window.webkitSpeechSynthesis;

        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.lang = 'zh-TW';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        const synth = window.speechSynthesis;

        recognition.onstart = () => {
            statusDiv.textContent = 'æ­£åœ¨è½æ‚¨èªªè©±... è«‹èªªå‡ºè¨‚å–® (ä¾‹: ç‡’é¤…ä¸‰å€‹, ç‰›è‚‰é¤¡é¤…äº”å€‹)';
            startButton.disabled = true;
            startButton.textContent = 'ğŸ”´ éŒ„éŸ³ä¸­...';
        };

        recognition.onend = () => {
            statusDiv.textContent = 'èªéŸ³è¼¸å…¥çµæŸï¼Œæ­£åœ¨è¨ˆç®—ã€‚';
            startButton.disabled = false;
            startButton.textContent = 'ğŸ™ï¸ é–‹å§‹èªéŸ³è¼¸å…¥';
        };

        // èªéŸ³è¾¨è­˜çµæœ (V3 ä¿®æ­£çš„æª¢æŸ¥ä¿ç•™)
        recognition.onresult = (event) => {
            if (event.results.length > 0 && event.results[0].length > 0) {
                const transcript = event.results[0][0].transcript;
                outputDiv.textContent = 'è¾¨è­˜çµæœ: ' + transcript;
                
                if (transcript && transcript.trim() !== '') {
                    calculateAndSpeak(transcript);
                } else {
                    outputDiv.textContent = 'è¾¨è­˜çµæœ: (ç„¡æœ‰æ•ˆèªéŸ³è¼¸å…¥)';
                    resultDiv.innerHTML = `ç¸½é‡‘é¡: $0`;
                }
            } else {
                outputDiv.textContent = 'è¾¨è­˜å¤±æ•—æˆ–æ²’æœ‰åµæ¸¬åˆ°æœ‰æ•ˆèªéŸ³ã€‚';
                resultDiv.innerHTML = `ç¸½é‡‘é¡: $0`;
            }
        };

        recognition.onerror = (event) => {
            statusDiv.textContent = 'èªéŸ³è¾¨è­˜éŒ¯èª¤: ' + event.error + 'ã€‚è«‹å†è©¦ä¸€æ¬¡ã€‚';
            startButton.disabled = false;
            startButton.textContent = 'ğŸ™ï¸ é–‹å§‹èªéŸ³è¼¸å…¥';
        };

        startButton.onclick = () => {
            try {
                recognition.start();
            } catch (e) {
                statusDiv.textContent = 'è«‹å…è¨±ç€è¦½å™¨ä½¿ç”¨éº¥å…‹é¢¨ã€‚éŒ¯èª¤: ' + e.message;
            }
        };

        /**
         * åŸ·è¡Œè¨‚å–®è¨ˆç®—ä¸¦èªéŸ³å”¸å‡ºçµæœ
         * @param {string} orderText - èªéŸ³è¾¨è­˜çš„æ–‡æœ¬
         */
        function calculateAndSpeak(orderText) {
            let total = 0;
            let orderSummary = {};
            let speechOutput = 'æ‚¨çš„è¨‚å–®æ˜¯ï¼š';

            // 1. æ•¸å­—å’Œé‡è©è™•ç† (V4 é—œéµèª¿æ•´ï¼šå°‡é‡è©æ›¿æ›ç‚ºç©ºæ ¼ï¼Œé¿å…æ•¸å­—ç›¸é€£)
            let processedText = orderText
                // æ›¿æ›ä¸­æ–‡æ•¸å­—
                .replace(/ä¸€/g, '1')
                .replace(/äºŒ|å…©/g, '2')
                .replace(/ä¸‰/g, '3')
                .replace(/å››/g, '4')
                .replace(/äº”/g, '5')
                .replace(/å…­/g, '6')
                .replace(/ä¸ƒ/g, '7')
                .replace(/å…«/g, '8')
                .replace(/ä¹/g, '9')
                .replace(/é›¶/g, '0')
                // æ›¿æ›é‡è©å’Œåˆ†éš”ç¬¦è™Ÿç‚ºå–®ä¸€ç©ºæ ¼
                .replace(/å€‹|ä»½|æ¯|ã€|ï¼Œ|,|ã€‚/g, ' '); 

            // å°‡å¤šå€‹ç©ºæ ¼åˆä½µç‚ºä¸€å€‹ç©ºæ ¼ï¼Œæ¸…ç†æ–‡æœ¬
            processedText = processedText.replace(/\s+/g, ' ').trim();

            let mutableText = processedText; 
            
            // 2. éæ­·æ’åºå¾Œçš„èœå–®å“é … (é•·åç¨±å„ªå…ˆ)
            itemNames.forEach(item => {
                const itemPrice = menu[item];
                let quantity = 0;
                let originalMatch = null;
                
                // 2a. å˜—è©¦ æ•¸é‡+å“é … (e.g. "3 è±¬è‚‰è›‹é¤…")
                const regexA = new RegExp(`(\\d+)\\s*(${item})`, 'i');
                // 2b. å˜—è©¦ å“é …+æ•¸é‡ (e.g. "è±¬è‚‰è›‹é¤… 1") - é—œéµä¿®æ­£!
                const regexB = new RegExp(`(${item})\\s*(\\d+)`, 'i');
                // 2c. å˜—è©¦ å–®å€‹å“é … (e.g. "è±¬è‚‰è›‹é¤…")
                const regexC = new RegExp(`\\b(${item})\\b`, 'i'); 
                
                let match;

                // --- å„ªå…ˆè™•ç†å¸¶æœ‰æ•¸å­—çš„çµ„åˆ ---
                // å˜—è©¦ Pattern A: æ•¸é‡åœ¨å‰
                if ((match = regexA.exec(mutableText))) {
                    quantity = parseInt(match[1], 10);
                    originalMatch = match[0];
                } 
                // å˜—è©¦ Pattern B: æ•¸é‡åœ¨å¾Œ (è§£æ±ºæ‚¨çš„å•é¡Œ)
                else if ((match = regexB.exec(mutableText))) {
                    // match[1] æ˜¯å“é …ï¼Œmatch[2] æ˜¯æ•¸å­—
                    quantity = parseInt(match[2], 10); 
                    originalMatch = match[0];
                } 
                // --- è™•ç†å–®å€‹å“é … (å‡è¨­æ•¸é‡ç‚º 1) ---
                else if ((match = regexC.exec(mutableText))) {
                    quantity = 1;
                    originalMatch = match[0];
                }
                
                // 3. è™•ç†è¨ˆæ•¸çµæœ
                if (quantity > 0) {
                    const itemCost = quantity * itemPrice;
                    total += itemCost;
                    
                    // è¨˜éŒ„è¨‚å–®ç´°ç¯€
                    orderSummary[item] = (orderSummary[item] || 0) + quantity;
                    
                    // é—œéµæ­¥é©Ÿï¼šå°‡å·²åŒ¹é…çš„å­—ä¸²å¾æ–‡æœ¬ä¸­ç§»é™¤
                    if (originalMatch) {
                        // ä½¿ç”¨å…¨å±€æ›¿æ›ä»¥ç¢ºä¿æ‰€æœ‰åŒ¹é…é …è¢«ç§»é™¤ (é›–ç„¶æ­£è¦è¡¨é”å¼åªæ‰¾ç¬¬ä¸€å€‹)
                        mutableText = mutableText.replace(new RegExp(originalMatch.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), '');
                        mutableText = mutableText.replace(/\s+/g, ' ').trim();
                    }
                }
            });

            // 4. æ ¼å¼åŒ–è¼¸å‡ºå’ŒèªéŸ³å…§å®¹
            let summaryText = '<ul>';
            let speechItems = [];
            for (const item in orderSummary) {
                const quantity = orderSummary[item];
                const cost = quantity * menu[item];
                summaryText += `<li>${item} x ${quantity} = $${cost}</li>`;
                speechItems.push(`${item}${quantity}å€‹`);
            }
            summaryText += '</ul>';

            if (total === 0) {
                resultDiv.innerHTML = `ç¸½é‡‘é¡: $0`;
                speechOutput = 'æŠ±æ­‰ï¼Œæˆ‘æ²’æœ‰è½æ¸…æ¥šæ‚¨çš„è¨‚å–®ï¼Œæˆ–æ˜¯èœå–®ä¸Šæ²’æœ‰æ‚¨é»çš„å“é …ã€‚è«‹å†èªªä¸€æ¬¡ã€‚';
            } else {
                resultDiv.innerHTML = `ç¸½é‡‘é¡: $${total}` + summaryText;
                speechOutput += speechItems.join('ï¼Œ') + `ã€‚ç¸½å…±æ˜¯ ${total} å…ƒã€‚`;
            }

            // èªéŸ³è¼¸å‡º
            const utterance = new SpeechSynthesisUtterance(speechOutput);
            utterance.lang = 'zh-TW';
            synth.speak(utterance);
        }
    }
</script>
</body>
</html>
